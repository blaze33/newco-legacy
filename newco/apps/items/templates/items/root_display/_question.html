{% load i18n %}
{% load voting_tags %}
{% load voting_utils %}
{% load content_utils %}
{% load bootstrap_tags %}

{% if display == "detail" or display == "list" %}
<div class="row question"><div class="span9" itemscope itemtype="http://schema.org/Article">{% with obj_id_q=question.id|slugify %}{% with anchor_q="q-"|add:obj_id_q %}

  <div class="row one_row{% if question.is_draft %} well well-small{% endif %}" id="{{ anchor_q }}">
    <div class="span1 vote-controls">
      {% vote_form question vote request.path|add:"#"|add:anchor_q %}{% if score %}{{ score.score }}{% else %}0{% endif %}
      {% edit_buttons user question delete_next=request.path %}
    </div>
    <div class="span8 question-content">
      {% if question.is_draft %}<p><small>{% trans "This question is a draft.<br>It has been anonymized." %}</small></p>{% else %}{% if display == "list" %}{% content_info question "signature" 32 %}{% elif display == "detail" %}{% content_info question "signature" 30 %}{% endif %}{% endif %}
      {% if display == "detail" %}
        <div class="content" itemprop="name">{{ question.content }}</div>
      {% else %}
        <a href="{{ question.get_absolute_url }}" itemprop="url"><span itemprop="name">{{ question.content }}</span></a>
      {% endif %}
    </div>
  </div>

  {% for answer in answers.queryset %}
    {% dict_entry_for_item answer from answers.votes as vote %}
    {% dict_entry_for_item answer from answers.scores as score %}
    <br>
    {% with obj_id=answer.id|slugify %}{% with anchor="a-"|add:obj_id %}<div class="row one_row" id="{{ anchor }}">
      <div class="span1 vote-controls">
        {% vote_form answer vote request.path|add:"#"|add:anchor %}{% if score %}{{ score.score }}{% else %}0{% endif %}
        {% edit_buttons user answer delete_next=request.path %}
      </div>
      <div class="span8 answer-content">
        {% content_info answer "signature" 32 %}
        {% if display == "detail" %}{% content_info answer "header" %}{% endif %}
        <div class="content" itemprop="description">{% autoescape off %}{{ answer.content }}{% endautoescape %}</div>
      </div>
    </div>{% endwith %}{% endwith %}
  {% endfor %}

  <div class="row"><div class="span6 offset1">
    {% if display == "list" %}
      <div class="block_controls row" id="controls_answer_form_{{ question.id }}">
        <div class="span3"><button class="btn btn-mini" data-toggle="collapse" data-target="#answer_form_{{ question.id }}"><i rel="icon" class="icon-share-alt"></i> <span rel="text">{% if question.answers.queryset %}{% trans "Add a better answer" %}{% else %}{% trans "Answer this question" %}{% endif %}</span></button></div>
        <div class="span3 right"><button class="btn btn-mini" data-toggle="modal" data-target="#ask"><i class="icon-user"></i> {% trans "Ask someone to answer" %}</button></div>
      </div>
    {% elif display == "detail" %}
        <hr>
        <div class="right"><button class="btn btn-mini" data-toggle="modal" data-target="#ask"><i class="icon-user"></i> {% trans "Ask someone to answer" %}</button></div>
    {% endif %}
    <br>
  </div></div>

  <div class="row"><div class="span7">
      <div id="answer_form_{{ question.id }}"class="row{% if display == "list" %} collapse {% if question.answer_form.errors %}in{% else %}out{% endif %}{% endif %}">
        {% if user.is_authenticated %}<div class="span1">{% include "profiles/_profile_edit_about.html" %}</div>{% endif %}
        <div class="span6{% if not user.is_authenticated %} offset1{% endif %}"><form method="POST" action="#answer_form_{{ question.id }}">
          {% csrf_token %}
          {{ question.answer_form|as_bootstrap }}
          <button type="submit" class="btn btn-mini" name="answer"><i class="icon-share-alt"></i> {% trans "Answer" %}</button>
          <input type="hidden" name="question_id" value="{{ question.id }}"/>
        </form></div>
      </div>
  </div></div>
{% endwith %}{% endwith %}</div></div>

{% include "items/_ask_modal.html" %}

{% if display == "list" %}<hr>{% endif %}
{% endif %}
