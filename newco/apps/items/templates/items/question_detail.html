{% extends "site_base.html" %}

{% load i18n %}
{% load staticfiles %}
{% load content_utils %}

{% block extra_style %}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/content.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}css/help.css">
    {% if question %}{{ question.answer_form.media.css }}{% endif %}
{% endblock %}

{% block head_title %}{{ question.content }}{% endblock %}

{% block body %}
<div class="row">
  <div class="span9" itemscope itemtype="http://schema.org/Article">{% include "items/feed_display/_question.html" with content=question display="text" q_detail="True" experts=experts display_a="all" displ_sign="True" scores=scores votes=votes user=user path=request.path statuses=statuses csrf_token=csrf_token only %}</div>

  <div class="span3 pull-right">
    <div class="row"><div class="span3 well well-small nc-right-col-well-span4">
      {% if question.items.count %}
        <h3>{% trans "Related products" %}</h3>
        <div id="thumbnails_list">{% for item in question.items.all %}
          {% include "items/feed_display/_thumbnail_frame.html" with object=item only %}
        {% endfor %}</div>
      {% elif question.tags.count %}
        <h3>{% trans "Related tags" %}</h3>
        {% tags_display question.tags %}
      {% endif %}
    </div></div>
    {% for title, content_list in related_questions.iteritems %}
      {% if content_list %}<div class="row"><div class="span3 well well-small nc-right-col-well-span4">
        <h3>{{ title }}</h3>
        <ul>{% for content in content_list %}<li><a href="{{ content.get_absolute_url }}">{{ content.content }}</a></li>{% endfor %}</ul>
      </div></div>{% endif %}
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block extra_body %}{% include "help/_ask_modal.html" %}{% endblock %}

{% block extra_script %}
  <script src="{% static 'js/content.js' %}"></script>
  <script src="{% static 'js/help.js' %}"></script>
  <script>
    $(function() {
        if ( '{{ ask_form.errors }}' ) { $("#modal-ask").modal("show"); }
    });
  </script>
  {% if question %}{{ question.answer_form.media.js }}{% endif %}
  <script>
    $(document).ready(function(){mixpanel.track("Load_question_detail");});
    if ($('div').hasClass('alert-success')){mixpanel.track("Event Success on Question Page");};


    {% if request.GET.focus_editor %}
      $(document).ready(function(){
          // .focus is triggered two times:
          // _ when $(document).ready: if $(document).ready after edito.on("load")
          // _ when edito.on("load"): if $(document).ready before edito.on("load")
          editor.focus();
          editor.on("load", function() {
              editor.focus();
          });
      });
    {% endif %}


    // script for "Edit your bio"
    $(function() {
        $("#submit-edit-about").click(function(event) {
            event.preventDefault();
            $('#modal-edit-about').modal('hide');
            $.ajax({
                type: "post",
                data: $("#form-edit-bio").serialize() + '&edit_about=edit_about',
                success: function(data, textstatus, jqxhr) {
                    console.log(data);
                    if (data.about === "") {
                        $('[rel=current-user-name-and-bio]').html("");
                        $('#btn-add-about').css('display','inline');
                        $('#btn-edit-about').css('display','none');
                    } else {
                        $('[rel=current-user-name-and-bio]').html(", " + data.about);
                        $('#btn-add-about').css('display','none');
                        $('#btn-edit-about').css('display','inline');
                    }
                },
                error: function(xhr, status, error) {
                    console.log(xhr, status, error);
                }
            });
            return false;
        });
    });
  </script>
  {% if request.GET.show_ask_to_answer %}<script>$(document).ready(function(){$('#ask').modal('show')});</script>{% endif %}
{% endblock %}