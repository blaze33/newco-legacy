{% load i18n %}
{% load bootstrap_tags %}
{% load content_utils %}
{% load account_tags %}

<p class="nf-small-grey">
  <a {% if answer_location == "embedded" %}data-toggle="collapse" data-target="#answer_form_{{ content.id }}"{% elif answer_location == "q_detail" %}href="{{ content.get_absolute_url }}"{% else %}href="{{ content.get_absolute_url }}"{% endif %}>{% if not answer_location == "embedded" %}{% if empty %}{% trans "Answer this question" %}{% else %}{% trans "Add an answer" %}{% endif %}</a> • {% endif %}{% comment %}<a class="nf-small-grey" href="#">{% trans "Follow" %}</a> • {% endcomment %}<a class="nf-small-grey btn-ask" {% if include_modal == "True" %}href="#" data-question-id="{{ content.id }}" data-toggle="modal" data-target="#modal-ask"{% else %}href="{% if content|to_class_name == "question" %}{{ content.get_absolute_url }}{% else %}{{ content.question.get_absolute_url }}{% endif %}?show_ask_to_answer=True"{% endif %}>{% trans "Ask to answer" %}</a>{% if display_a == "top" or display_a == "one" %}{% if content.answer_set.count > 1 %} • <a class="nf-small-grey" href="{{ content.get_absolute_url }}">{% blocktrans with nb_ans=content.answer_set.count %}View all answers ({{ nb_ans }}){% endblocktrans %}</a>{% elif content.answer_set.count == 1 %} • {% trans "This is the only answer" %}{% endif %}{% endif %}
</p>

{% if answer_location == "embedded" %}
  <br>
  <br>
  <div id="answer_form_{{ content.id }}" class="row">
    <div class="span8">
      <p>{% if user.is_authenticated %}
        <b>{% user_display user %}<span rel="current-user-name-and-bio">{% if user.get_profile.about %}, {{ user.get_profile.about }}{% endif %}</span></b>&nbsp;&nbsp;{% include "profiles/_profile_edit_about.html" %}
      {% else %}
        {% trans "Please login before answering." %}
      {% endif %}</p>

      <form method="POST" action="#answer_form_{{ content.id }}">{% csrf_token %}
        {{ content.answer_form|as_bootstrap }}
        <button type="submit" class="btn btn-primary btn-small" name="answer" value="{{ statuses.public }}"><i class="icon-share-alt icon-white"></i> {% trans "Answer and publish" %}</button>
        <button type="submit" class="btn btn-small" name="answer" value="{{ statuses.draft }}"><i class="icon-pencil"></i> {% trans "Save as draft" %}</button>
        <input type="hidden" name="question_id" value="{{ content.id }}"/>
      </form>
    </div>
  </div>
{% endif %}

{% if include_modal == "True" %}
  {% include "items/_ask_modal.html" with question=content experts=experts csrf_token=csrf_token only %} {# ToDo: ask_modal is not made to be displayed for each question => rework it to be coherent with this new structure #}
{% endif %}
