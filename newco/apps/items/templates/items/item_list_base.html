{% extends "site_base.html" %}

{% load url from future %}
{% load i18n %}
{% load account_tags %}
{% load content_utils %}
{% load pagination_tags %}

{% block extra_style %}
    {{ media.css }}
{% endblock %}

{% block body_class %}index{% endblock %}

{% block head_title %}{% trans "Products" %}{% if tag %} | {% trans "Tag" %} {{ tag }}{% endif %}{% endblock %}

{% block body %}

{% block carousel %}
<div class="row">
  <div class="span3"><h1>{% if tag %}{{ tag|capfirst }}</h1><div class="pull-right">
    {% if user.is_authenticated %}<form method="POST" action="">{% csrf_token %}{% if tag in user.get_profile.skills.all %}
      <a class="tooltip-bottom" title="{% blocktrans %}Click to remove tag {{ tag }} from your skill list{% endblocktrans %}"><button type="submit" class="btn btn-mini btn-primary" name="skills" value="remove">{% trans "In my skills" %}</button></a>
    {% else %}
      <a class="tooltip-bottom" title="{% blocktrans %}Click to add tag {{ tag }} to your skill list{% endblocktrans %}"><button type="submit" class="btn btn-mini" name="skills" value="add">{% trans "Add to skills" %}</button></a>
    {% endif %}</form>{% endif %}
  </div>{% elif search_terms %}{{ search_terms }}{% else %}{% trans "Products" %}{% endif %}</div>
  <div class="span7" align="center">{% if item_list.count %}
    <div id="carousel_tag" class="carousel slide">
      <div class="carousel-inner">{% for item in item_list %}
        <div class="{% if forloop.first %}active {% endif %}item">
          <a href="{{ item.get_absolute_url }}"><img src="{{ item.image.data.link }}" alt=""></a>
          <div class="carousel-caption"><h4>{{ item.name }}</h4></div>
        </div>
      {% endfor %}</div>

      <a class="carousel-control left" data-slide="prev" href="#carousel_tag">&lsaquo;</a>
      <a class="carousel-control right" data-slide="next" href="#carousel_tag">&rsaquo;</a>
    </div>
  {% else %}&nbsp;{% endif %}</div>

  <div class="span2"><a class="btn" href="{% url 'item_create' 'item' %}"><i class="icon-plus-sign"></i> {% trans "Add a product" %}</a></div>
</div>
{% endblock %}

{% block content %}

<div class="tabbable">
  <div class="row"><ul class="offset3 nav nav-tabs" id="main-tab">
    <li{% if cat == "home" %} class="active"{% endif %}><a href="{% url 'tagged_items' tag.slug %}">{% trans "Home" %} - {{ tag|capfirst }}</a></li>
    <li{% if cat == "products" %} class="active"{% endif %}><a href="{% url 'tagged_items' tag.slug 'products' %}">{% trans "Products" %}</a></li>
    <li{% if cat == "questions" %} class="active"{% endif %}><a href="{% url 'tagged_items' tag.slug 'questions' %}">{% trans "Questions" %}</a></li>
  </ul></div>
  {% block list %}{% endblock %}
</div>
{% if is_paginated %}<div class="row"><div class="offset3">{% paginate %}</div></div>{% endif %}
{% endblock %}

{% endblock %}

{% block extra_script %}
  {{ media.js }}
  <script type="text/javascript">
        $(document).ready(function() {
            $('#carousel_tag').carousel({ interval: 10000 });
        });

      function apply_masonry(list_container, list_items){
        $(list_container).masonry({ //'#thumbnails_list'
          itemSelector : list_items, //'.masonry-item'
          isAnimated: true,
          isFitWidth: true,
        });
      }

      function TriggerMasonry(){
        setTimeout("apply_masonry('#thumbnails_list', '.masonry-item')", 500);
        setTimeout("apply_masonry('#thumbnails_list2', '.masonry-item2')", 500);
        setTimeout("apply_masonry('#thumbnails_list', '.masonry-item')", 2000);
        setTimeout("apply_masonry('#thumbnails_list2', '.masonry-item2')", 2000);
      }

      $(document).ready(function() {
        TriggerMasonry();
      });

      $('a[data-toggle="tab"]').on('shown', function (e) {
        TriggerMasonry();
      });

    $(document).ready(function(){
      mixpanel.track("Load_tag_page");
    });
  </script>
{% endblock %}
