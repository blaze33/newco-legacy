{% extends "site_base.html" %}

{% load url from future %}
{% load i18n %}
{% load bootstrap_tags %}
{% load staticfiles %}

{% block extra_style %}
  {{ block.super }}
  <script type="text/javascript" src="{% static 'admin/js/jquery.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'admin/js/jquery.init.js' %}"></script>

  <script type="text/javascript">
      (function ($) {
          $(function () {
              $(".chzn-select").each(function(i, select) {
                  var $select = $(select);
                  $select.chosen({max_selected_options: 1, no_results_text: "{{ form.no_results }}"});
                  $select.bind("liszt:maxselected", function () {});
              });
          });
      })((typeof window.django != 'undefined') ? django.jQuery : jQuery);
  </script>

  {{ form.media }}
  {{ formset.media.css }}
{% endblock %}

{% block head_title %}{% trans "Question" %}{% endblock %}

{% block body %}

<div class="row">
  <div class="span8">
    <h1>{% block form_header %}{% if not question %}{% trans "Ask a question" %}{% else %}{% trans "Edit your question" %}{% endif %}{% endblock %}</h1>
    <br>
    <form class="form-horizontal" action="" method="POST">{% csrf_token %}
      {{ form|as_bootstrap }}

      <div class="control-group" id="div_submit_q"{% if cb_answer %} style="visibility: hidden;" {% endif %}>
        <div class="controls">
          <button type="submit" class="btn btn-primary" name="add_question" value="{{ status.public }}">{% if question.is_public %}{% trans "Update and keep public" %}{% elif question.is_draft %}{% trans "Update and publish" %}{% else %}{% trans "Publish your question" %}{% endif %}</button>
          <button type="submit" class="btn" name="add_question" value="{{ status.draft }}">{% if question.is_public %}{% trans "Unpublish and save as draft" %}{% elif question.is_draft %}{% trans "Update and keep as draft" %}{% else %}{% trans "Save as draft" %}{% endif %}</button>
        </div>
      </div>

      {% if formset %}
        <div class="control-group"><div class="controls">
          <span class="pull-right">
            <button class="btn btn-mini btn-success" type="button" data-toggle="collapse" data-target="#why_answer_your_q" style="z-index: 0 ;"><i rel="add_icon" class="icon-plus icon-white" style="margin-right: 3px; position: relative; top: -2px;"></i>{% trans "Why is it encouraged?" %}</button>
          </span>
          <label class="checkbox">
            <input type="checkbox" name="cb_answer" data-toggle="collapse" data-target="#answer_form"{% if cb_answer %} checked{% endif %}>
            {% trans "Answer your own question" %}
          </label>
          <br>
          <div id="why_answer_your_q" class="collapse out">
            <div class="well well-small">
              {% blocktrans %}<h3>We encourage you to answer your own questions.</h3> Why? On NewCo, giving answers to others is central. And sometimes you know things, but you don't find a question relative to it. We encourage you to document that knowledge, create your own Q&A, like a FAQ, so it can benefit others.
              {% endblocktrans %}
            </div>
          </div>
        </div></div>
        <div id="answer_form" class="row collapse {% if formset_errors or cb_answer %}in{% else %}out{% endif %}"><div class="span7">
          {{ formset.management_form }}
          {% for form in formset %}
            {{ form|as_bootstrap }}
          {% endfor %}
        </div></div>
        <div class="control-group" id="div_submit_qa"{% if not cb_answer %} style="display: none;"{% endif %}>
          <div class="controls">
            <button type="submit" class="btn btn-primary" name="add_question" value="{{ status.public }}">{% trans "Publish your question and answer" %}</button>
            <button type="submit" class="btn" name="add_question" value="{{ status.draft }}">{% trans "Save as draft" %}</button>
          </div>
        </div>
      {% endif %}

      {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

      <div class="modal fade hide" id="itemModal" tabindex="-1" role="dialog" aria-labelledby="itemModalLabel" aria-hidden="true">
        <div class="modal-header">
          <a type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
          <h3 id="itemModalLabel">{% trans "Add a product"%}{% trans ":" %}</h3>
        </div>
        <div class="modal-body">{{ i_form|as_bootstrap }}</div>
        <div class="modal-footer">
          <a class="btn" data-dismiss="modal" aria-hidden="true">{% trans "Cancel" %}</a>
          <input type="submit" class="btn btn-primary" name="add_item" value="{% trans 'Add product' %}">
        </div>
      </div>

    </form>
  </div>
  <div class="span4">
    <span class="pull-right"><button class="btn btn-mini btn-success" data-toggle="collapse" data-target="#div_tips" style="z-index: 0 ;"><i rel="add_icon" class="icon-plus icon-white" style="margin-right: 3px; position: relative; top: -2px;"></i>{% trans "Tips" %}</button></span>
    <br><br>
    <div class="row collapse out" id="div_tips"><div class="well well-small">
      {% blocktrans %}
        <h4>Tips:</h4>
        Here, you can ask a question about one or several products:
        <ol>
          <li>Write down your question.</li>
          <li>Select products or tags to bind that question to, using the search bars.</li>
          <li>Once the question submitted, you can wait for an answer or, if you are getting impatient, <b>ask an expert</b> to help you out.</li>
        </ol>
      {% endblocktrans %}
    </div></div>
  </div>
</div>

{% endblock %}

{% block extra_body_base %}
  {{ block.super }}
  {{ formset.media.js }}
  <script type="text/javascript">
    {% if show %}$("#itemModal").modal("show"){% endif %}
    $('#answer_form').on('hide', function () {
      $('#div_submit_q').css('visibility','visible');
      $('#div_submit_qa').css('display','none');
    })
    $('#answer_form').on('show', function () {
      $('#div_submit_q').css('visibility','hidden');
      $('#div_submit_qa').css('display','inline');
    })

    function hide_tags_show_items() {
      $('#div_id_items').css('opacity','1');
      $('#div_id_tags').css('opacity','0.5');
    }
    function hide_items_show_tags() {
      $('#div_id_items').css('opacity','0.5');
      $('#div_id_tags').css('opacity','1');
    }

    if($("#id_parents_1").is(":checked")){hide_tags_show_items();}
    if($("#id_parents_2").is(":checked")){hide_items_show_tags();}
    $('#id_parents_1').click(function () {hide_tags_show_items();})
    $('#id_parents_2').click(function () {hide_items_show_tags();})
  </script>
{% endblock %}

{% block extra_script %}
  {{ block.super }}
	<script type ="text/javascript">
		$(document).ready(function(){
	    mixpanel.track("Load_add_question");
		});
	</script>
{% endblock %}

{# TITLE: Default #}