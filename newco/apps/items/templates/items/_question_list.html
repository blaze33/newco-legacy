{% load i18n %}
{% load voting_tags %}
{% load voting_utils %}
{% load content_utils %}
{% load staticfiles %}

{% votes_by_user user on questions as question_vote_dict %}
{% scores_for_objects questions as question_score_dict %}

{% for question in questions %}
{% if question.is_published or user == question.author %}
{% if not question.is_published %}<div class="well">{% endif %}
<div class="row question" >
<div class="span10">
    {% dict_entry_for_item question from question_vote_dict as vote %}
    {% dict_entry_for_item question from question_score_dict as score %}

    <div class="row one_row" id="q-{{ question.id }}">
        <div class="span1"><h3 class="right">{% if score %}{{ score.score }}{% else %}0{% endif %}{% vote_form question vote %}</h3></div>
        <div class="span4"><h3>
            {{ question.content }}
            {% if user.is_superuser or question.author == request.user %}
                {% with name=question|to_class_name %}{% edit name question.id %}{% endwith %}
            {% endif %}
        </h3></div>
        <div class="span2 right">{% include "items/_author.html" with object=question %}</div>
		{% if user == question.author %}{% include "items/_status_form.html" with content=question %}{% endif %}
    </div>
    {% votes_by_user user on question.answer_set.all as answer_vote_dict %}
    {% scores_for_objects question.answer_set.all as answer_score_dict %}

    {% for answer in question.answer_set.all %}
    	{% if answer.is_published or user == answer.author %}
		{% if not answer.is_published %}<div class="well">{% endif %}
        
        {% dict_entry_for_item answer from answer_vote_dict as vote %}
        {% dict_entry_for_item answer from answer_score_dict as score %}
        <div class="row one_row" id="a-{{ answer.id }}" rel="popover">
            <div class="span1"><h3 class="right">{% if score %}{{ score.score }}{% else %}0{% endif %}{% vote_form answer vote %}</h3></div>
            <div class="span4"><p>
                {{ answer.content }}
                {% if user.is_superuser or answer.author == request.user %}
                    {% with name=answer|to_class_name %}{% edit name answer.id %}{% endwith %}
                {% endif %}
            </p></div>
            <div class="span2 right">{% include "items/_author.html" with object=answer %}</div>
            {% if user == answer.author %}{% include "items/_status_form.html" with content=answer %}{% endif %}
        </div>
        {% if not answer.is_published %}</div>{% endif %}
        {% endif %}
    {% endfor %}
    <div class="row"><div class="span4 offset1 block_controls"><a href='{% url item_create "answer" %}?question_id={{ question.id }}' class="btn btn-mini" name="add_answer">
        <i class="icon-share-alt"></i>{% if question.answer_set.all %}{% trans "Add a better answer" %}{% else %}{% trans "Answer this question" %}{% endif %}
    </a></div></div>
    <hr>
</div></div>
{% if not question.is_published %}</div>{% endif %}
{% endif %}
{% endfor %}
