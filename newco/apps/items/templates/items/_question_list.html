{% load i18n %}
{% load voting_tags %}
{% load voting_utils %}
{% load content_utils %}
{% load staticfiles %}
{% load bootstrap_tags %}



<div class="row"><div class="span7">
    <i rel="add_icon" class="icon-plus" style="opacity: 0.1 ; cursor: pointer; cursor: hand; z-index: -1 ; position: relative; left: 20px; top: -13px;"></i>
    <span class="nc_transition_add" style="position: relative; left: -5px; top: -15px;">
        <button class="btn btn-mini btn-success " data-toggle="collapse" data-target="#question_form" style="z-index: 0 ;"><i rel="add_icon" class="icon-plus"></i></button>
        {% if questions %}<h2 style="display:inline; opacity:0.2; position:relative; left:55px; top:4px;" rel="add_q_text">{% trans "Ask a new question!" %}</h2>{% endif %}
    </span>{% if not questions %}<h2 style="display:inline; opacity:0.2; position:relative; left:55px; top:-10px;" rel="add_q_text_no_q_yet">{% trans "No question yet! Ask the first one here!" %}</h2>{% endif %}
    
    <div id="question_form" class="collapse out" style="position: relative; left: 65px; top: -40px;">
        <form method="POST" action="" class="form-inline">{% if not questions %}<br><br><br>{% endif %}
            {% csrf_token %}
            {% with field=q_form.content %}<div id="div_{{ field.auto_id }}" class="control-group {% if field.errors %}error{% endif %} {% if field.css_classes %} {{ field.css_classes }}{% endif %}"><div class="controls">
                <div class="input-prepend input-append">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="add-on"><i class="icon-question-sign"></i></span>{{ field }}<button type="submit" class="btn" name="question"><i class="icon-share-alt"></i></button>
                </div>
                {% include "bootstrap/_field_errors.html" %}
                {% include "bootstrap/_field_help_text.html" %}
            </div></div>{% endwith %}
        </form>
    </div>
</div></div>

{% votes_by_user user on questions as question_vote_dict %}
{% scores_for_objects questions as question_score_dict %}

{% for question in questions %}
<div class="row question">
<div class="span7">
    {% dict_entry_for_item question from question_vote_dict as vote %}
    {% dict_entry_for_item question from question_score_dict as score %}

    <div class="row one_row" id="q-{{ question.id }}">
        <div class="span1"><h3 class="right">{% if score %}{{ score.score }}{% else %}0{% endif %}{% vote_form question vote %}</h3></div>
        <div class="span4"><h3>
            <a href="{% url item_detail 'question' question.id 'ROOO' %}">{{ question.content }}</a>
            {% if user.is_superuser or question.author == request.user %}
                {% with name=question|to_class_name %}{% edit name question.id %}{% endwith %}
            {% endif %}
        </h3></div>
        <div class="span2 right">{% include "items/_author.html" with object=question %}</div>
    </div>
    {% votes_by_user user on question.answer_set.all as answer_vote_dict %}
    {% scores_for_objects question.answer_set.all as answer_score_dict %}

    {% for answer in question.answer_set.all %}{% if answer.is_public %}
        {% dict_entry_for_item answer from answer_vote_dict as vote %}
        {% dict_entry_for_item answer from answer_score_dict as score %}
        <div class="row one_row" id="a-{{ answer.id }}" rel="popover">
            <div class="span1"><h3 class="right">{% if score %}{{ score.score }}{% else %}0{% endif %}{% vote_form answer vote %}</h3></div>
            <div class="span4"><p>
                {% autoescape off %}{{ answer.content }}{% endautoescape %}
                {% if user.is_superuser or answer.author == request.user %}
                    {% with name=answer|to_class_name %}{% edit name answer.id %}{% endwith %}
                {% endif %}
            </p></div>
            <div class="span2 right">{% include "items/_author.html" with object=answer %}</div>
        </div>
    {% endif %}{% endfor %}

    <div class="row"><div class="span6 offset1">
        <div class="block_controls"><button class="btn btn-mini" data-toggle="collapse" data-target="#answer_form_{{ question.id }}"><i class="icon-share-alt"></i> {% if question.answer_set.all %}{% trans "Add a better answer" %}{% else %}{% trans "Answer this question" %}{% endif %}</button></div>
        <br />
        <div id="answer_form_{{ question.id }}" class="collapse out"><form method="POST" action="">
            {% csrf_token %}
            {{ question.answer_form|as_bootstrap }}
            <button type="submit" class="btn btn-mini" name="answer"><i class="icon-share-alt"></i> {% trans "Answer" %}</button>
            <input type="hidden" name="question_id" value="{{ question.id }}"/>
            
        </form></div>
    </div></div>
    <hr>
</div></div>
{% endfor %}
