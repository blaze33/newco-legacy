{% extends "theme_bootstrap/base.html" %}

{% load url from future %}
{% load metron_tags %}
{% load i18n %}
{% load staticfiles %}
{% load account_tags %}

{% block extra_style %}
    <link href="{% static 'css/global.css' %}" rel="stylesheet">
    <!--
    We may need to use font-awesome. Won't replace glyphicons for the moment
    due to bad pixel fitting of small icons.
    <link rel="stylesheet" href="{% static "css/font-awesome.css" %}">
    -->
    <link rel="icon" href="{% static 'img/favicon.png' %}" type="image/png" />
    <link rel="shortcut icon" href="{% static 'favicon.ico' %}" />

    {% include "feedback/header.html" %}
{% endblock %}

{% block extra_head_base %}
    {{ block.super }}
    <script type="text/javascript" src="{% static 'js/ga.js' %}"></script>
    <script type="text/javascript">var var_mixpanel="{{ MIXPANEL_KEY_ID }}";</script>
    <script type="text/javascript" src="{% static 'js/mixpanel.js' %}"></script>
{% endblock %}

{% block navbar_class %}navbar-fixed-top navbar-inverse{% endblock %}

{% block nav %}
<ul class="nav pull-left" id="mixpanel_identity"{% if user.is_authenticated %} data-user_id="{{ request.user.id }}" data-email="{{ request.user.email }}" data-created="{{ request.user.date_joined }}" data-name="{% user_display request.user %}" data-bio="{{ user.get_profile.about }}" data-reputation="{{ user.reputation.reputation_incremented }}"{% endif %}>
    <li class="offset1 span4"><form class="navbar-search form-search" action="{% url 'search' %}" method="POST">{% csrf_token %}
        <div class="input-append">
            <input type="text" autocomplete="off" class="typeahead span4 search-query" name="q" id="global_search" placeholder="{% trans 'Search for product, user or tag' %}">
            <button type="submit" class="btn btn-inverse" style="position: relative; top: -4px; padding: 4px 5px;"><i class="icon-search icon-white"></i></button>
        </div>
        <input type="hidden" id="obj_class" name="obj_class"/>
        <input type="hidden" id="obj_id" name="obj_id"/>
    </form></li>
</ul>
{% endblock %}

{% block footer %}
    {% include "_footer.html" %}

    {{ block.super }}
{% endblock %}

{% block extra_script %}
    <script type="text/javascript" src="{% static 'admin/js/jquery.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'admin/js/jquery.init.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery.masonry.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery-ui-1.8.21.custom.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/global.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/expand.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/mixpanel_functions.js' %}"></script>

    <script src="{% static 'bootstrap/js/bootstrap-typeahead.js' %}"></script>
    <script type="text/javascript">
        $(function() {
            var labels, mapped
            $("#global_search").typeahead({
                source: function (query, process) {
                    $.get('{% url "redis" %}', {q: query}, function (data) {
                        labels = []
                        mapped = {}

                        $.each(data, function (i, item) {
                            mapped[item.title] = item
                            labels.push(item.title)
                        })
                        process(labels)
                    })
                }
                , updater: function (item) {
                    var obj = mapped[item];
                    $('#obj_class').val(obj.class);
                    $('#obj_id').val(obj.id);
                    return obj.title
                }
            });
        });
    </script>
    <script src="{% static 'bootstrap/js/bootstrap-popover.js' %}"></script>
{% endblock %}

{% block extra_body_base %}
    {{ block.super }}

    {% analytics %}

    {% block extra_body %}{% endblock %}

    {% include "feedback/button.html" %}
{% endblock %}
