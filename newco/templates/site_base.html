{% extends "theme_bootstrap/base.html" %}

{% load url from future %}
{% load metron_tags %}
{% load i18n %}
{% load staticfiles %}
{% load account_tags %}

{% block extra_style %}
    <link href="{% static 'css/global.css' %}" rel="stylesheet">
<!--
We may need to use font-awesome. Won't replace glyphicons for the moment
due to bad pixel fitting of small icons.
<link rel="stylesheet" href="{% static "css/font-awesome.css" %}">
-->
    <link rel="icon" href="{% static 'img/favicon.png' %}" type="image/png" />
    <link rel="shortcut icon" href="{% static 'favicon.ico' %}" />

    {% include "feedback/header.html" %}
{% endblock %}

{% block extra_head_base %}
    {{ block.super }}
    <script type="text/javascript" src="{% static 'js/ga.js' %}"></script>
    <script type="text/javascript">var var_mixpanel="{{ MIXPANEL_KEY_ID }}";</script>
    <script type="text/javascript" src="{% static 'js/mixpanel.js' %}"></script>
{% endblock %}

{% block nav %}
{% if user.is_authenticated %}
    <ul class="nav" id="mixpanel_identity" data-user_id="{{ request.user.id }}" data-email="{{ request.user.email }}" data-created="{{ request.user.date_joined }}" data-name="{% user_display request.user %}" data-bio="{{ user.get_profile.about }}" data-reputation="{{ user.reputation.reputation_incremented }}">
{% else %}
    <ul class="nav" id="mixpanel_identity">
{% endif %}
        <li id="tab_typeahead"><form class="navbar-search" action="{% url 'content_search' %}" method="POST">{% csrf_token %}<div class="input-append"><input type="text" class="search-query span3" name="item_search" id="main_autocomplete"><button id="mixpanel_typeahead" class="btn" type="submit" style="margin:0;height:28px;"><i class="icon-search"></i> {% trans "Search" %}</button></div></form></li>
    </ul>
{% endblock %}

{% block footer %}
    {% include "_footer.html" %}

    {{ block.super }}
{% endblock %}

{% block extra_script %}
    <script type="text/javascript" src="{% static 'admin/js/jquery.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'admin/js/jquery.init.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery.masonry.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery-ui-1.8.21.custom.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/global.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/expand.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/mixpanel_functions.js' %}"></script>
    <script type="text/javascript">
    function TriggerMasonry(){
    	$('#thumbnails_list').masonry({
			itemSelector : '.content-item',
	        isAnimated: true,
	        isFitWidth: true,
            // columnWidth: 180,
            columnWidth: function( containerWidth ) {
                return containerWidth / 40; // Seb: this thing is a mess... Maybe it's a matter of denominator ? (colunms/size of page)...
            },
		});
    }
    $(document).ready(function() {
       // simple example, using all default options unless overridden globally
	  TriggerMasonry();
      setTimeout(TriggerMasonry,4000); // retrigger masonry in case the .js were very long to load - happens often when loading is long
	  $('div.expandable').expander({
				afterExpand:function() {TriggerMasonry();},
				//Timer to relaunch Masonry after the onCollapse event
				onCollapse:function(byUser) {timeout=setTimeout(TriggerMasonry,500);
				}
	 	});
    });
    </script>

    {% include "autocomplete_light/static.html" %}
    <script type="text/javascript">
    $(document).ready(function() {
        $('input#main_autocomplete').yourlabsAutocomplete({
            url: "{% url 'autocomplete' %}",
            zindex: 99999,
            id: 'main_autocomplete',
            iterablesSelector: 'li:has(a)',
            defaultValue: "{% trans 'Search an item, a tag...' %}",
            placeholder : "{% trans 'What are you looking for?' %}",
        });
    });
    </script>
{% endblock %}

{% block extra_body_base %}
    {{ block.super }}

    {% analytics %}

    {% block extra_body %}{% endblock %}

    {% include "feedback/button.html" %}
{% endblock %}
